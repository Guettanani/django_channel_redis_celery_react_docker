<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Message</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Intégrer Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container" style="margin-top:50px;margin-left:50px;">
        <canvas id="myChart" width="400" height="400"></canvas>
    </div>
    {{ unread_count|json_script:"unread-count" }}
    <!-- Script pour initialiser le graphique et mettre à jour les données -->
    <script>
        
        // Initialiser le graphique avec des données statiques
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1', '2', '3', '4', '5'],
                datasets: [{
                    label: 'Unread Count',
                    data: [5, 10, 15, 20, 25],
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Fonction pour mettre à jour le graphique avec les nouvelles données
        function updateChart(newData) {
            // Mettre à jour les étiquettes du graphique
            myChart.data.labels.push((myChart.data.labels.length + 1).toString());

            // Mettre à jour les données du graphique
            myChart.data.datasets[0].data.push(newData);

            // Limiter le nombre de données affichées à 10 pour une meilleure visualisation
            if (myChart.data.labels.length > 10) {
                myChart.data.labels.shift();
                myChart.data.datasets[0].data.shift();
            }

            // Mettre à jour le graphique
            myChart.update();
        }
        var unread_count = JSON.parse(document.getElementById('unread-count').textContent);

        const notifySocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/sms/notification'
            + '/'
        );

        notifySocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log(data);
            
            var newData = Math.floor(Math.random() * 30) + 1;
            unread_count += newData;
            updateChart(unread_count);
            //document.querySelector('#unread-content').textContent = unread_count;
        };

        notifySocket.onclose = function(e) {
            console.log('Web socket is closed.')
        };
        // Simulation de mise à jour de données en temps réel (remplacez cette partie avec votre logique de mise à jour réelle)
        /*
        setInterval(function() {
            var newData = Math.floor(Math.random() * 30) + 1; // Générer un nombre aléatoire entre 1 et 30
            updateChart(newData); // Mettre à jour le graphique avec les nouvelles données
        }, 5000); // Mettre à jour toutes les 5 secondes (5000 millisecondes)
        //*/
    </script>
</body>
</html>
